@model List<P1_EDDll_AFPE_DAVH.Models.Message>;
<nav class="navigation-bar row">
    <h2 class="text-white col-11 ml-3 p-0 m-0">@ViewBag.Chatname</h2>
    <a class="btn-claro my-0">Regresar</a>
</nav>
<div class="mensajes">
    @foreach (var message in Model)
    {
        <div ng-class="{ @ViewBag.UserID == @message.Id}"></div>
    }
</div>
<div class="footer-emisor row">
    <button class="col-1 icon-btn"></button>
    <input class="col-10 input-messagge" type="text" placeholder="Escribe aquí tu mensaje"/>
    <button class="col-1 icon-btn"></button>
</div>

<script src="~/lib/microsoft/signalr/dist/browser/signalr.min.js"></script>

<script>
    var connection = new signalR.HubConnectionBuilder().withUrl("/chat").build();
    connection.start().then(() => {
        connection.invoke("AddToGroup", "@Model")
    }).catch((e) => console.error(e));

    document.getElementById("btnSend").addEventListener("click", (event) => {
        let room = "@Model";
        let user = document.getElementById("user").value;
        let message = document.getElementById("message").value;

        connection.invoke("SendMessage", room, user, message).catch((err) => console.error(err.toString()));
        document.getElementById("message").value = "";
        document.getElementById("message").focus();
        event.preventDefault();

    })

    connection.on("ReceiveMessage", (user, message) =>
    {
        var message = "<div ><b>" + user + " said:</b> " + message + "</div>";
        document.getElementById("messages").innerHTML = message + document.getElementById("messages").innerHTML;
    }); 


</script>
